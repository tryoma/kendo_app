<% provide(:title, "稽古会") %>
<h1><%= @event.place %>の稽古会</h1>

<div class="event-show">
  <div class="event-map">
  <script type="text/javascript">
      function initMap() {
        let test ={lat: <%= @event.latitude %>, lng: <%= @event.longitude %>};
        let map = new google.maps.Map(document.getElementById('map'), {
                  zoom: 16, 
                  center: test
                  });
        let transitLayer = new google.maps.TransitLayer();
        transitLayer.setMap(map);
    
        let contentString = '住所：<%= @event.place %>';
        let infowindow = new google.maps.InfoWindow({
          content: contentString
        });
    
        let marker = new google.maps.Marker({
                      position:test,
                      map: map,
                      title: contentString
                     });
    
         marker.addListener('click', function() {
           infowindow.open(map, marker);
         });
      }
    </script>
    
    <script async defer
                  src="https://maps.googleapis.com/maps/api/js?v=3.exp&key=AIzaSyA9u1aAUZeLUxkwQ95Wok82cO1NEaGsY94&callback=initMap">
    </script>
    <style type="text/css">
      #map { height: 500px;
             width: 100%;}
    </style>
    <div id="map"></div>

  </div>
  <div class="event-information-list">
    <p><%= @event.event_day %></p>
    <p><%= @event.start_time %></p>
    <p><%= @event.finish_time %></p>
  </div>
  <div class="event-confirmation">
    <%= link_to '参加しますか？', 
      event_members_path(@event),
      method: :post,
      data: { confirm: "このイベントに参加しますか？" },
      class: "btn btn-primary" %>
    <%= link_to '参加取りやめ',
      event_member_path(@event),
      method: :delete,
      data: { confirm: "このイベントを参加取りやめますか？" },
      class: "btn btn-danger" %>
  </div>
  <div class="event-comment">
    <%= form_with(model:[@event, @comment]) do |f| %>
      <p>
        <%= f.label :body,"コメント" %>
        <%= f.text_field :body %>
      </p>
      <%= f.submit %>
    <% end %>
    <% @comments.each do |comment| %>
      <hr>
      <p>
        <span><%= comment.user.profile.name %>: </span>
        <%= comment.body %>
        <% if comment.user == current_user %>
          <%= link_to "削除", event_comment_path(@event.id, comment.id), method: :delete,
                  data: { confirm: "削除してよろしいですか？" },
                  class: "btn btn-danger" %>
        <% end %>
      </p>
    <% end %>
  </div>
</div>
